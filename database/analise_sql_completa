-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ“Š ANÃLISE COMPLETA - SISTEMA PACKBAG
-- Sistema de Monitoramento IoT - Aguai & Casa Branca
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

USE entrega5;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ“ˆ 1. RESUMO GERAL DO SISTEMA
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• RESUMO GERAL â•â•â•â•â•â•â•â•' as '';

SELECT 
    COUNT(*) as 'Total de Leituras',
    COUNT(DISTINCT ID_Sensor) as 'Sensores com Dados',
    COUNT(DISTINCT ID_Filial) as 'Filiais Ativas',
    MIN(Timestamp) as 'Primeira Leitura',
    MAX(Timestamp) as 'Ãšltima Leitura',
    TIMESTAMPDIFF(HOUR, MIN(Timestamp), MAX(Timestamp)) as 'Horas Monitoradas'
FROM FATO_LEITURAS;

-- Status dos Sensores
SELECT 'â•â•â•â•â•â•â•â• STATUS DOS SENSORES â•â•â•â•â•â•â•â•' as '';

SELECT 
    Status,
    COUNT(*) as 'Quantidade',
    GROUP_CONCAT(CONCAT(Tipo_Sensor, ' (ID:', ID_Sensor, ')') SEPARATOR ', ') as 'Detalhes'
FROM DIM_SENSOR
GROUP BY Status;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ¢ 2. ANÃLISE POR FILIAL
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• DESEMPENHO POR FILIAL â•â•â•â•â•â•â•â•' as '';

SELECT 
    f.Nome_Filial as 'Filial',
    f.Cidade,
    COUNT(DISTINCT fl.ID_Sensor) as 'Sensores Ativos',
    COUNT(fl.ID_Leitura) as 'Total Leituras',
    ROUND(AVG(fl.Temperatura), 1) as 'Temp MÃ©dia (Â°C)',
    ROUND(AVG(fl.Umidade), 1) as 'Umid MÃ©dia (%)',
    ROUND(SUM(fl.Consumo_kWh), 4) as 'Consumo Total (kWh)',
    SUM(fl.Movimento_Detectado) as 'Movimentos Detectados',
    SUM(fl.Lampada_Ligada) as 'Acionamentos LÃ¢mpada',
    MAX(fl.Timestamp) as 'Ãšltima AtualizaÃ§Ã£o'
FROM DIM_FILIAL f
LEFT JOIN FATO_LEITURAS fl ON f.ID_Filial = fl.ID_Filial
GROUP BY f.ID_Filial, f.Nome_Filial, f.Cidade
ORDER BY COUNT(fl.ID_Leitura) DESC;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ“¡ 3. ANÃLISE POR TIPO DE SENSOR
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• DESEMPENHO POR TIPO DE SENSOR â•â•â•â•â•â•â•â•' as '';

SELECT 
    s.Tipo_Sensor as 'Tipo',
    s.Modelo,
    COUNT(DISTINCT s.ID_Sensor) as 'Qtd Sensores',
    COUNT(fl.ID_Leitura) as 'Total Leituras',
    ROUND(AVG(fl.Temperatura), 1) as 'Temp MÃ©dia',
    ROUND(AVG(fl.Umidade), 1) as 'Umid MÃ©dia',
    SUM(fl.Movimento_Detectado) as 'Movimentos',
    ROUND(SUM(fl.Consumo_kWh), 4) as 'Consumo (kWh)',
    ROUND(AVG(fl.Qualidade_Sinal), 1) as 'Qualidade Sinal (%)'
FROM DIM_SENSOR s
LEFT JOIN FATO_LEITURAS fl ON s.ID_Sensor = fl.ID_Sensor
GROUP BY s.Tipo_Sensor, s.Modelo
ORDER BY COUNT(fl.ID_Leitura) DESC;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸŒ¡ï¸ 4. ANÃLISE DE TEMPERATURA E UMIDADE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• ESTATÃSTICAS DE TEMPERATURA â•â•â•â•â•â•â•â•' as '';

SELECT 
    f.Nome_Filial as 'Filial',
    ROUND(MIN(fl.Temperatura), 1) as 'Temp MÃ­nima (Â°C)',
    ROUND(AVG(fl.Temperatura), 1) as 'Temp MÃ©dia (Â°C)',
    ROUND(MAX(fl.Temperatura), 1) as 'Temp MÃ¡xima (Â°C)',
    ROUND(STDDEV(fl.Temperatura), 1) as 'Desvio PadrÃ£o',
    COUNT(CASE WHEN fl.Temperatura > 30 THEN 1 END) as 'Leituras > 30Â°C',
    COUNT(CASE WHEN fl.Temperatura < 20 THEN 1 END) as 'Leituras < 20Â°C'
FROM DIM_FILIAL f
JOIN FATO_LEITURAS fl ON f.ID_Filial = fl.ID_Filial
WHERE fl.Temperatura IS NOT NULL
GROUP BY f.ID_Filial, f.Nome_Filial;

SELECT 'â•â•â•â•â•â•â•â• ESTATÃSTICAS DE UMIDADE â•â•â•â•â•â•â•â•' as '';

SELECT 
    f.Nome_Filial as 'Filial',
    ROUND(MIN(fl.Umidade), 1) as 'Umid MÃ­nima (%)',
    ROUND(AVG(fl.Umidade), 1) as 'Umid MÃ©dia (%)',
    ROUND(MAX(fl.Umidade), 1) as 'Umid MÃ¡xima (%)',
    ROUND(STDDEV(fl.Umidade), 1) as 'Desvio PadrÃ£o',
    COUNT(CASE WHEN fl.Umidade > 70 THEN 1 END) as 'Leituras > 70%',
    COUNT(CASE WHEN fl.Umidade < 40 THEN 1 END) as 'Leituras < 40%'
FROM DIM_FILIAL f
JOIN FATO_LEITURAS fl ON f.ID_Filial = fl.ID_Filial
WHERE fl.Umidade IS NOT NULL
GROUP BY f.ID_Filial, f.Nome_Filial;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸš¶ 5. ANÃLISE DE MOVIMENTO
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• ANÃLISE DE DETECÃ‡ÃƒO DE MOVIMENTO â•â•â•â•â•â•â•â•' as '';

SELECT 
    f.Nome_Filial as 'Filial',
    s.Localizacao as 'LocalizaÃ§Ã£o',
    COUNT(*) as 'Total Leituras',
    SUM(fl.Movimento_Detectado) as 'Movimentos Detectados',
    ROUND(SUM(fl.Movimento_Detectado) * 100.0 / COUNT(*), 1) as 'Taxa DetecÃ§Ã£o (%)',
    SUM(fl.Lampada_Ligada) as 'Acionamentos LÃ¢mpada',
    MAX(fl.Timestamp) as 'Ãšltimo Movimento'
FROM DIM_FILIAL f
JOIN DIM_SENSOR s ON f.ID_Filial = s.ID_Filial
JOIN FATO_LEITURAS fl ON s.ID_Sensor = fl.ID_Sensor
WHERE s.Tipo_Sensor IN ('Movimento', 'Iluminacao')
GROUP BY f.Nome_Filial, s.Localizacao
ORDER BY SUM(fl.Movimento_Detectado) DESC;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- âš¡ 6. ANÃLISE DE CONSUMO DE ENERGIA
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• CONSUMO DE ENERGIA â•â•â•â•â•â•â•â•' as '';

SELECT 
    f.Nome_Filial as 'Filial',
    ROUND(SUM(fl.Consumo_kWh), 4) as 'Consumo Total (kWh)',
    ROUND(AVG(fl.Consumo_kWh), 6) as 'Consumo MÃ©dio (kWh)',
    SUM(fl.Lampada_Ligada) as 'Horas LÃ¢mpada Ligada',
    ROUND(SUM(fl.Consumo_kWh) * 0.85, 2) as 'Custo Estimado (R$)',
    COUNT(DISTINCT DATE(fl.Timestamp)) as 'Dias Monitorados'
FROM DIM_FILIAL f
JOIN FATO_LEITURAS fl ON f.ID_Filial = fl.ID_Filial
GROUP BY f.ID_Filial, f.Nome_Filial
ORDER BY SUM(fl.Consumo_kWh) DESC;

-- Consumo por sensor
SELECT 'â•â•â•â•â•â•â•â• CONSUMO POR SENSOR â•â•â•â•â•â•â•â•' as '';

SELECT 
    f.Nome_Filial as 'Filial',
    s.Tipo_Sensor as 'Tipo Sensor',
    s.Localizacao as 'LocalizaÃ§Ã£o',
    ROUND(SUM(fl.Consumo_kWh), 4) as 'Consumo (kWh)',
    SUM(fl.Lampada_Ligada) as 'Tempo Ligado',
    ROUND(SUM(fl.Consumo_kWh) * 0.85, 2) as 'Custo (R$)'
FROM DIM_FILIAL f
JOIN DIM_SENSOR s ON f.ID_Filial = s.ID_Filial
JOIN FATO_LEITURAS fl ON s.ID_Sensor = fl.ID_Sensor
WHERE fl.Consumo_kWh > 0
GROUP BY f.Nome_Filial, s.Tipo_Sensor, s.Localizacao
ORDER BY SUM(fl.Consumo_kWh) DESC;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ“… 7. ANÃLISE TEMPORAL
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• ATIVIDADE POR PERÃODO DO DIA â•â•â•â•â•â•â•â•' as '';

SELECT 
    t.Periodo_Dia as 'PerÃ­odo',
    COUNT(*) as 'Total Leituras',
    SUM(fl.Movimento_Detectado) as 'Movimentos',
    ROUND(AVG(fl.Temperatura), 1) as 'Temp MÃ©dia (Â°C)',
    ROUND(AVG(fl.Umidade), 1) as 'Umid MÃ©dia (%)',
    ROUND(SUM(fl.Consumo_kWh), 4) as 'Consumo (kWh)'
FROM DIM_TEMPO t
JOIN FATO_LEITURAS fl ON t.ID_Data = fl.ID_Data
GROUP BY t.Periodo_Dia
ORDER BY FIELD(t.Periodo_Dia, 'Madrugada', 'ManhÃ£', 'Tarde', 'Noite');

SELECT 'â•â•â•â•â•â•â•â• ATIVIDADE POR DIA DA SEMANA â•â•â•â•â•â•â•â•' as '';

SELECT 
    t.DiaSemana as 'Dia',
    COUNT(*) as 'Total Leituras',
    SUM(fl.Movimento_Detectado) as 'Movimentos',
    ROUND(AVG(fl.Temperatura), 1) as 'Temp MÃ©dia (Â°C)',
    ROUND(SUM(fl.Consumo_kWh), 4) as 'Consumo (kWh)'
FROM DIM_TEMPO t
JOIN FATO_LEITURAS fl ON t.ID_Data = fl.ID_Data
GROUP BY t.DiaSemana
ORDER BY FIELD(t.DiaSemana, 'Segunda', 'TerÃ§a', 'Quarta', 'Quinta', 'Sexta', 'SÃ¡bado', 'Domingo');

SELECT 'â•â•â•â•â•â•â•â• ATIVIDADE POR HORA DO DIA â•â•â•â•â•â•â•â•' as '';

SELECT 
    t.Hora as 'Hora',
    COUNT(*) as 'Leituras',
    SUM(fl.Movimento_Detectado) as 'Movimentos',
    ROUND(SUM(fl.Consumo_kWh), 4) as 'Consumo (kWh)'
FROM DIM_TEMPO t
JOIN FATO_LEITURAS fl ON t.ID_Data = fl.ID_Data
GROUP BY t.Hora
ORDER BY t.Hora;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- âš ï¸ 8. ALERTAS E PROBLEMAS DETECTADOS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• ALERTAS CRÃTICOS â•â•â•â•â•â•â•â•' as '';

-- Temperaturas extremas
SELECT 
    'ğŸ”¥ Temperatura Alta' as 'Tipo Alerta',
    f.Nome_Filial as 'Filial',
    s.Localizacao as 'Local',
    ROUND(fl.Temperatura, 1) as 'Valor',
    fl.Timestamp as 'Quando'
FROM FATO_LEITURAS fl
JOIN DIM_SENSOR s ON fl.ID_Sensor = s.ID_Sensor
JOIN DIM_FILIAL f ON fl.ID_Filial = f.ID_Filial
WHERE fl.Temperatura > 32
ORDER BY fl.Temperatura DESC
LIMIT 5;

SELECT 
    'â„ï¸ Temperatura Baixa' as 'Tipo Alerta',
    f.Nome_Filial as 'Filial',
    s.Localizacao as 'Local',
    ROUND(fl.Temperatura, 1) as 'Valor',
    fl.Timestamp as 'Quando'
FROM FATO_LEITURAS fl
JOIN DIM_SENSOR s ON fl.ID_Sensor = s.ID_Sensor
JOIN DIM_FILIAL f ON fl.ID_Filial = f.ID_Filial
WHERE fl.Temperatura < 19
ORDER BY fl.Temperatura ASC
LIMIT 5;

-- Umidade extrema
SELECT 
    'ğŸ’§ Umidade Alta' as 'Tipo Alerta',
    f.Nome_Filial as 'Filial',
    s.Localizacao as 'Local',
    ROUND(fl.Umidade, 1) as 'Valor (%)',
    fl.Timestamp as 'Quando'
FROM FATO_LEITURAS fl
JOIN DIM_SENSOR s ON fl.ID_Sensor = s.ID_Sensor
JOIN DIM_FILIAL f ON fl.ID_Filial = f.ID_Filial
WHERE fl.Umidade > 80
ORDER BY fl.Umidade DESC
LIMIT 5;

-- Sensores sem dados recentes
SELECT 'â•â•â•â•â•â•â•â• SENSORES COM POSSÃVEIS PROBLEMAS â•â•â•â•â•â•â•â•' as '';

SELECT 
    f.Nome_Filial as 'Filial',
    s.ID_Sensor as 'ID Sensor',
    s.Tipo_Sensor as 'Tipo',
    s.Localizacao as 'Local',
    MAX(fl.Timestamp) as 'Ãšltima Leitura',
    TIMESTAMPDIFF(MINUTE, MAX(fl.Timestamp), NOW()) as 'Minutos Sem Dados'
FROM DIM_SENSOR s
JOIN DIM_FILIAL f ON s.ID_Filial = f.ID_Filial
LEFT JOIN FATO_LEITURAS fl ON s.ID_Sensor = fl.ID_Sensor
WHERE s.Status = 'Ativo'
GROUP BY s.ID_Sensor, f.Nome_Filial, s.Tipo_Sensor, s.Localizacao
HAVING TIMESTAMPDIFF(MINUTE, MAX(fl.Timestamp), NOW()) > 10
ORDER BY TIMESTAMPDIFF(MINUTE, MAX(fl.Timestamp), NOW()) DESC;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ† 9. RANKING E COMPARAÃ‡Ã•ES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• RANKING DE SENSORES MAIS ATIVOS â•â•â•â•â•â•â•â•' as '';

SELECT 
    f.Nome_Filial as 'Filial',
    s.Tipo_Sensor as 'Tipo',
    s.Localizacao as 'Local',
    COUNT(*) as 'Total Leituras',
    SUM(fl.Movimento_Detectado) as 'Movimentos',
    ROUND(SUM(fl.Consumo_kWh), 4) as 'Consumo (kWh)'
FROM DIM_SENSOR s
JOIN DIM_FILIAL f ON s.ID_Filial = f.ID_Filial
JOIN FATO_LEITURAS fl ON s.ID_Sensor = fl.ID_Sensor
GROUP BY s.ID_Sensor, f.Nome_Filial, s.Tipo_Sensor, s.Localizacao
ORDER BY COUNT(*) DESC
LIMIT 10;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ“Š 10. TENDÃŠNCIAS E INSIGHTS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• CORRELAÃ‡ÃƒO TEMPERATURA x MOVIMENTO â•â•â•â•â•â•â•â•' as '';

SELECT 
    CASE 
        WHEN fl.Temperatura < 20 THEN '< 20Â°C'
        WHEN fl.Temperatura BETWEEN 20 AND 25 THEN '20-25Â°C'
        WHEN fl.Temperatura BETWEEN 25 AND 30 THEN '25-30Â°C'
        ELSE '> 30Â°C'
    END as 'Faixa Temperatura',
    COUNT(*) as 'Total Leituras',
    SUM(fl.Movimento_Detectado) as 'Movimentos',
    ROUND(SUM(fl.Movimento_Detectado) * 100.0 / COUNT(*), 1) as 'Taxa Movimento (%)'
FROM FATO_LEITURAS fl
WHERE fl.Temperatura IS NOT NULL
GROUP BY CASE 
    WHEN fl.Temperatura < 20 THEN '< 20Â°C'
    WHEN fl.Temperatura BETWEEN 20 AND 25 THEN '20-25Â°C'
    WHEN fl.Temperatura BETWEEN 25 AND 30 THEN '25-30Â°C'
    ELSE '> 30Â°C'
END;

SELECT 'â•â•â•â•â•â•â•â• EFICIÃŠNCIA ENERGÃ‰TICA â•â•â•â•â•â•â•â•' as '';

SELECT 
    f.Nome_Filial as 'Filial',
    COUNT(*) as 'Total Leituras',
    SUM(fl.Movimento_Detectado) as 'Movimentos',
    SUM(fl.Lampada_Ligada) as 'Acionamentos',
    ROUND(SUM(fl.Lampada_Ligada) * 100.0 / NULLIF(SUM(fl.Movimento_Detectado), 0), 1) as 'EficiÃªncia (%)',
    ROUND(SUM(fl.Consumo_kWh) / NULLIF(SUM(fl.Movimento_Detectado), 0), 6) as 'kWh por Movimento'
FROM DIM_FILIAL f
JOIN FATO_LEITURAS fl ON f.ID_Filial = fl.ID_Filial
GROUP BY f.ID_Filial, f.Nome_Filial;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ“ 11. ÃšLTIMAS 10 LEITURAS DETALHADAS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'â•â•â•â•â•â•â•â• ÃšLTIMAS 10 LEITURAS â•â•â•â•â•â•â•â•' as '';

SELECT 
    fl.Timestamp as 'Data/Hora',
    f.Nome_Filial as 'Filial',
    s.Tipo_Sensor as 'Sensor',
    s.Localizacao as 'Local',
    CONCAT(COALESCE(ROUND(fl.Temperatura, 1), '-'), 'Â°C') as 'Temp',
    CONCAT(COALESCE(ROUND(fl.Umidade, 1), '-'), '%') as 'Umid',
    IF(fl.Movimento_Detectado = 1, 'âœ…', '-') as 'Mov',
    IF(fl.Lampada_Ligada = 1, 'ğŸ’¡', '-') as 'Lamp',
    fl.Consumo_kWh as 'Consumo',
    fl.Status_Leitura as 'Status'
FROM FATO_LEITURAS fl
JOIN DIM_SENSOR s ON fl.ID_Sensor = s.ID_Sensor
JOIN DIM_FILIAL f ON fl.ID_Filial = f.ID_Filial
ORDER BY fl.Timestamp DESC
LIMIT 10;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- âœ… FIM DA ANÃLISE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SELECT 'âœ… AnÃ¡lise Completa Finalizada!' as '';
